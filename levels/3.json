{
  "hr": [
    {
      "query_id": "hr_l3_1",
      "query": "Find all staff members who joined in 2023 and group them by department, along with their respective department policies.",
      "expected_response": {
        "department_staff_policies": [
          {
            "department_name": "Support",
            "staff": [
              {
                "employee_name": "Mia White",
                "date_joined": "2023-01-15",
                "email": "mia.white@example.com"
              }
            ],
            "policy_title": "Support Policy",
            "policy_effective_date": "2023-01-01"
          },
          {
            "department_name": "Logistics",
            "staff": [
              {
                "employee_name": "Olivia Martin",
                "date_joined": "2023-03-05",
                "email": "olivia.martin@example.com"
              }
            ],
            "policy_title": "Logistics Policy",
            "policy_effective_date": "2023-03-01"
          },
          {
            "department_name": "Business Development",
            "staff": [
              {
                "employee_name": "Peter Thompson",
                "date_joined": "2023-04-20",
                "email": "peter.thompson@example.com"
              }
            ],
            "policy_title": "Business Development Policy",
            "policy_effective_date": "2023-04-01"
          },
          {
            "department_name": "Compliance",
            "staff": [
              {
                "employee_name": "Riley Martinez",
                "date_joined": "2023-06-10",
                "email": "riley.martinez@example.com"
              }
            ],
            "policy_title": "Compliance Policy",
            "policy_effective_date": "2023-06-01"
          },
          {
            "department_name": "Production",
            "staff": [
              {
                "employee_name": "Sophia Robinson",
                "date_joined": "2023-07-05",
                "email": "sophia.robinson@example.com"
              }
            ],
            "policy_title": "Production Policy",
            "policy_effective_date": "2023-07-01"
          }
        ]
      },
      "explanation": "Complex join involving three tables (employees, departments, policies) with date filtering for employee join dates in 2023 and staff role filtering.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_employees",
            "filter": "(role='Staff') AND (date_joined >= '2023-01-01') AND (date_joined <= '2023-12-31')",
            "related": "hr_departments_by_department_id"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_policies",
            "filter": "department_id IN (13, 15, 16, 18, 19)"
          }
        }
      ],
      "sample_solution": "First query HR_EMPLOYEES filtered by role='Staff' and date_joined in 2023 with related HR_DEPARTMENTS, then query HR_POLICIES and combine the results based on department_id."
    },
    {
      "query_id": "hr_l3_2",
      "query": "Identify departments that have policies effective in the first half of 2023 but don't have any employees who joined in the same period.",
      "expected_response": {
        "departments_with_gap": []
      },
      "explanation": "Complex multi-table analysis requiring date range comparison between policy effective dates and employee join dates.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_policies",
            "filter": "(effective_date >= '2023-01-01') AND (effective_date <= '2023-06-30')"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_employees",
            "filter": "(date_joined > '2023-06-30') AND (department_id IN (13, 14, 15, 16, 17, 18))"
          }
        }
      ],
      "sample_solution": "Query HR_POLICIES filtered by effective_date in first half of 2023, then query HR_EMPLOYEES filtered by date_joined after June 30, 2023, and department_id in the specified list."
    },
    {
      "query_id": "hr_l3_3",
      "query": "Calculate the average time between policy implementation and manager appointments for each department in 2022-2023.",
      "expected_response": {
        "department_timing_analysis": [
          {
            "department_name": "Engineering",
            "policy_date": "2022-03-01",
            "manager_joined_date": "2022-03-05",
            "days_difference": 4,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "Finance",
            "policy_date": "2022-05-01",
            "manager_joined_date": "2022-05-15",
            "days_difference": 14,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "IT",
            "policy_date": "2022-08-01",
            "manager_joined_date": "2022-08-20",
            "days_difference": 19,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "R&D",
            "policy_date": "2022-11-01",
            "manager_joined_date": "2022-11-05",
            "days_difference": 4,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "Quality Assurance",
            "policy_date": "2023-02-01",
            "manager_joined_date": "2023-02-10",
            "days_difference": 9,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "Strategy",
            "policy_date": "2023-05-01",
            "manager_joined_date": "2023-05-15",
            "days_difference": 14,
            "timing_pattern": "Manager joined after policy implementation"
          },
          {
            "department_name": "Innovation",
            "policy_date": "2023-08-01",
            "manager_joined_date": "2023-08-20",
            "days_difference": 19,
            "timing_pattern": "Manager joined after policy implementation"
          }
        ],
        "average_days_difference": 11.86,
        "insight": "Managers typically join departments shortly after policy implementation, with an average delay of about 12 days."
      },
      "explanation": "Complex date analysis requiring correlation between manager appointment dates and policy effective dates across departments.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_employees",
            "fields": ["employee_id", "date_joined", "department_id"],
            "filter": "(role='Manager') AND (date_joined >= '2022-01-01') AND (date_joined <= '2023-12-31')"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_policies",
            "filter": "department_id IN (3, 5, 8, 11, 14, 17, 20) AND (effective_date >= '2022-01-01') AND (effective_date <= '2023-12-31')"
          }
        }
      ],
      "sample_solution": "Query HR_EMPLOYEES filtered by role='Manager' with related HR_DEPARTMENTS, then query HR_POLICIES, calculate time differences between policy effective dates and manager join dates for each department."
    },
    {
      "query_id": "hr_l3_4",
      "query": "Analyze the distribution of employees by role across departments that have policies implemented in 2023 and identify which departments have the most balanced ratio of managers to staff.",
      "expected_response": {
        "role_distribution_analysis": [
          {
            "department_name": "Support",
            "policy_date": "2023-01-01",
            "managers": 0,
            "staff": 1,
            "manager_to_staff_ratio": 0,
            "balanced_rating": "No managers"
          },
          {
            "department_name": "Quality Assurance",
            "policy_date": "2023-02-01",
            "managers": 1,
            "staff": 0,
            "manager_to_staff_ratio": null,
            "balanced_rating": "No staff"
          },
          {
            "department_name": "Logistics",
            "policy_date": "2023-03-01",
            "managers": 0,
            "staff": 1,
            "manager_to_staff_ratio": 0,
            "balanced_rating": "No managers"
          },
          {
            "department_name": "Business Development",
            "policy_date": "2023-04-01",
            "managers": 0,
            "staff": 1,
            "manager_to_staff_ratio": 0,
            "balanced_rating": "No managers"
          },
          {
            "department_name": "Strategy",
            "policy_date": "2023-05-01",
            "managers": 1,
            "staff": 0,
            "manager_to_staff_ratio": null,
            "balanced_rating": "No staff"
          },
          {
            "department_name": "Compliance",
            "policy_date": "2023-06-01",
            "managers": 0,
            "staff": 1,
            "manager_to_staff_ratio": 0,
            "balanced_rating": "No managers"
          },
          {
            "department_name": "Production",
            "policy_date": "2023-07-01",
            "managers": 0,
            "staff": 1,
            "manager_to_staff_ratio": 0,
            "balanced_rating": "No managers"
          },
          {
            "department_name": "Innovation",
            "policy_date": "2023-08-01",
            "managers": 1,
            "staff": 0,
            "manager_to_staff_ratio": null,
            "balanced_rating": "No staff"
          }
        ],
        "insight": "None of the departments with 2023 policies have both managers and staff. Three departments (Quality Assurance, Strategy, Innovation) have only managers, while five departments have only staff members. This suggests potential management or staffing imbalances across departments with newly implemented policies."
      },
      "explanation": "Complex analysis involving multiple tables (departments, policies, employees) with role-based filtering, date filtering, and ratio calculations.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_policies",
            "filter": "(effective_date >= '2023-01-01') AND (effective_date <= '2023-12-31')",
            "related": "hr_departments_by_department_id"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_employees",
            "filter": "department_id IN (13, 14, 15, 16, 17, 18, 19, 20)"
          }
        }
      ],
      "sample_solution": "Query HR_POLICIES filtered by effective_date in 2023 with related HR_DEPARTMENTS, then query HR_EMPLOYEES filtered by the relevant department_ids, and analyze role distribution to determine manager-to-staff ratios for each department."
    },
    {
      "query_id": "hr_l3_5",
      "query": "Identify departments where the policy was implemented before any employees joined, and calculate the average delay between policy implementation and the first employee joining these departments.",
      "expected_response": {
        "policy_first_departments": [
          {
            "department_name": "Sales",
            "policy_effective_date": "2022-01-01",
            "first_employee_joined": "2022-01-15",
            "days_delay": 14,
            "employee_name": "Alice Johnson",
            "employee_role": "Staff"
          },
          {
            "department_name": "Marketing",
            "policy_effective_date": "2022-02-01",
            "first_employee_joined": "2022-02-10",
            "days_delay": 9,
            "employee_name": "Bob Smith",
            "employee_role": "Staff"
          },
          {
            "department_name": "Engineering",
            "policy_effective_date": "2022-03-01",
            "first_employee_joined": "2022-03-05",
            "days_delay": 4,
            "employee_name": "Carol Williams",
            "employee_role": "Manager"
          },
          {
            "department_name": "HR",
            "policy_effective_date": "2022-04-01",
            "first_employee_joined": "2022-04-20",
            "days_delay": 19,
            "employee_name": "David Brown",
            "employee_role": "Staff"
          },
          {
            "department_name": "Finance",
            "policy_effective_date": "2022-05-01",
            "first_employee_joined": "2022-05-15",
            "days_delay": 14,
            "employee_name": "Eve Davis",
            "employee_role": "Manager"
          },
          {
            "department_name": "Operations",
            "policy_effective_date": "2022-06-01",
            "first_employee_joined": "2022-06-10",
            "days_delay": 9,
            "employee_name": "Frank Miller",
            "employee_role": "Staff"
          },
          {
            "department_name": "Customer Service",
            "policy_effective_date": "2022-07-01",
            "first_employee_joined": "2022-07-05",
            "days_delay": 4,
            "employee_name": "Grace Wilson",
            "employee_role": "Staff"
          },
          {
            "department_name": "IT",
            "policy_effective_date": "2022-08-01",
            "first_employee_joined": "2022-08-20",
            "days_delay": 19,
            "employee_name": "Henry Moore",
            "employee_role": "Manager"
          }
        ],
        "average_delay": 11.5,
        "insight": "All departments established in 2022 had their policies implemented before any employees joined, with an average delay of 11.5 days between policy implementation and the first employee joining. Departments that first hired managers tended to have more varied delays (4-19 days) compared to those that first hired staff."
      },
      "explanation": "Complex analysis requiring temporal sequencing of policy implementation dates versus employee join dates across departments, with date-difference calculations.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_policies",
            "fields": ["policy_id", "title", "effective_date", "department_id"],
            "order_by": "effective_date ASC",
            "related": "hr_departments_by_department_id"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "hr_employees",
            "fields": [
              "employee_id",
              "first_name",
              "last_name",
              "date_joined",
              "department_id",
              "role"
            ],
            "order_by": "date_joined ASC",
            "related": "hr_departments_by_department_id"
          }
        }
      ],
      "sample_solution": "Query HR_POLICIES with related HR_DEPARTMENTS, then query HR_EMPLOYEES with related HR_DEPARTMENTS, identify departments where policy effective_date is earlier than the earliest employee date_joined, calculate date differences, and determine the average delay."
    }
  ],
  "finance": [
    {
      "query_id": "finance_l3_1",
      "query": "Compare the performance of software products against their capital expenses in 2022. For each quarter, show the total software revenue and any capital expenses made in that period, and calculate the return on investment (ROI).",
      "expected_response": {
        "quarterly_analysis": [
          {
            "quarter": "Q1 2022",
            "software_products": ["Product 5", "Product 17"],
            "total_revenue": 3100,
            "capital_expenses": 0,
            "roi": null,
            "notes": "No capital expenses in this quarter"
          },
          {
            "quarter": "Q2 2022",
            "software_products": ["Product 2", "Product 14"],
            "total_revenue": 2800,
            "capital_expenses": 1200,
            "roi": 1.33,
            "notes": "High capital expenses"
          },
          {
            "quarter": "Q3 2022",
            "software_products": ["Product 11"],
            "total_revenue": 1550,
            "capital_expenses": 0,
            "roi": null,
            "notes": "No capital expenses in this quarter"
          },
          {
            "quarter": "Q4 2022",
            "software_products": ["Product 8", "Product 20"],
            "total_revenue": 3400,
            "capital_expenses": 500,
            "roi": 5.8,
            "notes": "Good ROI with moderate capital investment"
          }
        ],
        "summary": "Software product revenues fluctuated throughout 2022, with Q4 showing the highest revenue. Capital expenses were concentrated in Q2 and Q4, with Q4 showing the best ROI. The overall trend shows variable revenue performance with strategic capital investments."
      },
      "explanation": "This query requires joining three tables (products, revenues, expenses), filtering by product category and expense type, and calculating financial metrics (ROI) across quarters.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_products",
            "filter": "category='Software'",
            "related": "finance_revenues_by_product_id"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_expenses",
            "filter": "(category='Capital') AND (expense_date >= '2022-01-01') AND (expense_date <= '2022-12-31')"
          }
        }
      ],
      "sample_solution": "First query software products with their revenue data, then query capital expenses for 2022. Group revenues by quarter and match with corresponding capital expenses to calculate ROI."
    },
    {
      "query_id": "finance_l3_2",
      "query": "What was the quarterly profit (revenue minus expenses) for Q1 2022?",
      "expected_response": {
        "q1_2022_profit": 6500
      },
      "explanation": "Multi-table analysis requiring date alignment between revenue quarters and expense dates",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_revenues",
            "filter": "(quarter=1) AND (year=2022)",
            "fields": ["revenue_amount", "revenue_date", "quarter", "year"]
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_expenses",
            "filter": "(expense_date >= '2022-01-01') AND (expense_date <= '2022-03-31')",
            "fields": ["amount", "expense_date"]
          }
        }
      ]
    },
    {
      "query_id": "finance_l3_3",
      "query": "What percentage of total 2023 expenses were Operational vs Capital?",
      "expected_response": {
        "total_expenses": 5570,
        "operational_expenses": 2220,
        "capital_expenses": 1700,
        "operational_percentage": 39.86,
        "capital_percentage": 30.52
      },
      "explanation": "Category-based percentage calculation with full-year filtering",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_expenses",
            "filter": "(expense_date >= '2023-01-01') AND (expense_date <= '2023-12-31')",
            "fields": ["amount", "category"]
          }
        }
      ]
    },
    {
      "query_id": "finance_l3_4",
      "query": "List categories with their total revenue, ordered by highest performing category",
      "expected_response": {
        "category_totals": [
          { "category": "Software", "total_revenue": 10850 },
          { "category": "Electronics", "total_revenue": 10500 },
          { "category": "Hardware", "total_revenue": 9150 }
        ]
      },
      "explanation": "Category-based aggregation with join between products and revenues",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "finance_products",
            "related": "finance_revenues_by_product_id",
            "fields": ["category", "name"]
          }
        }
      ]
    }
  ],
  "ops": [
    {
      "query_id": "ops_l3_1",
      "query": "Count the number of maintenance actions for machines in different locations, only for machines installed before 2022.",
      "expected_response": {
        "maintenance_by_location": {
          "New York": 1,
          "Los Angeles": 1,
          "Chicago": 1,
          "Houston": 1,
          "Phoenix": 1,
          "Philadelphia": 1,
          "San Antonio": 1,
          "San Diego": 1,
          "Dallas": 1,
          "San Jose": 1,
          "Austin": 1,
          "Jacksonville": 1
        }
      },
      "explanation": "Requires counting maintenance actions per location for machines installed before 2022.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "ops_machines",
            "filter": "installation_date < '2022-01-01'",
            "related": "ops_maintenance_by_machine_id",
            "fields": ["location", "installation_date"]
          }
        }
      ],
      "sample_solution": "Query OPS_MACHINES with installation_date filter and related maintenance, count maintenance actions per location."
    },
    {
      "query_id": "ops_l3_2",
      "query": "What percentage of maintenance actions resulted in anomaly detection, broken down by machine location?",
      "expected_response": {
        "anomaly_rates": [
          { "location": "Los Angeles", "anomaly_rate": 100.0 },
          { "location": "Phoenix", "anomaly_rate": 100.0 },
          { "location": "Dallas", "anomaly_rate": 100.0 },
          { "location": "Charlotte", "anomaly_rate": 100.0 },
          { "location": "Washington", "anomaly_rate": 100.0 },
          { "location": "New York", "anomaly_rate": 0.0 },
          { "location": "Chicago", "anomaly_rate": 0.0 },
          { "location": "Houston", "anomaly_rate": 0.0 },
          { "location": "Philadelphia", "anomaly_rate": 0.0 },
          { "location": "San Antonio", "anomaly_rate": 0.0 },
          { "location": "San Diego", "anomaly_rate": 0.0 },
          { "location": "San Jose", "anomaly_rate": 0.0 },
          { "location": "Austin", "anomaly_rate": 0.0 },
          { "location": "Jacksonville", "anomaly_rate": 0.0 },
          { "location": "Fort Worth", "anomaly_rate": 0.0 },
          { "location": "Columbus", "anomaly_rate": 0.0 },
          { "location": "San Francisco", "anomaly_rate": 0.0 },
          { "location": "Indianapolis", "anomaly_rate": 0.0 },
          { "location": "Seattle", "anomaly_rate": 0.0 },
          { "location": "Denver", "anomaly_rate": 0.0 }
        ]
      },
      "explanation": "Requires temporal filtering, anomaly status analysis, and location-based grouping using joins.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "ops_machines",
            "related": "ops_maintenance_by_machine_id",
            "fields": ["location", "anomaly_detected"]
          }
        }
      ],
      "sample_solution": "Query OPS_MACHINES with related OPS_MAINTENANCE, calculate anomaly percentages per location."
    },
    {
      "query_id": "ops_l3_3",
      "query": "Calculate the average time between machine installation and first maintenance for machines installed in 2021 versus 2022.",
      "expected_response": {
        "installation_year_comparison": {
          "2021": {
            "total_machines": 12,
            "machines_with_maintenance": 12,
            "avg_days_to_first_maintenance": 365.6
          },
          "2022": {
            "total_machines": 8,
            "machines_with_maintenance": 8,
            "avg_days_to_first_maintenance": 367.13
          }
        },
        "insight": "Machines installed in 2022 received their first maintenance sooner after installation (367.13 days on average) compared to machines installed in 2021 (365.6 days on average)."
      },
      "explanation": "Requires date calculations between installation and maintenance dates, grouped by installation year.",
      "tools_needed": ["get_table_records"],
      "expected_tool_calls": [
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "ops_machines",
            "filter": "installation_date >= '2021-01-01' AND installation_date <= '2021-12-31'",
            "fields": ["machine_id", "installation_date"],
            "related": "ops_maintenance_by_machine_id"
          }
        },
        {
          "tool": "get_table_records",
          "params": {
            "table_name": "ops_machines",
            "filter": "installation_date >= '2022-01-01' AND installation_date <= '2022-12-31'",
            "fields": ["machine_id", "installation_date"],
            "related": "ops_maintenance_by_machine_id"
          }
        }
      ],
      "sample_solution": "Query OPS_MACHINES with installation dates and related maintenance, calculate date differences, and group by installation year to compare averages."
    }
  ]
}
